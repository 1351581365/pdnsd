#!/bin/sh

# $Id: pdnsd.in,v 1.1 2000/10/11 22:29:05 thomas Exp $
#
# This script was written and contributed by Markus Mohr, and
# slightly modified by me for version 1.0.6 (which obviously
# broke it some way). I then applied a set of corrections
# by Markus Mohr.
#
# Carsten Block has patched this with some magic so that
# the actual script is generated by configure, and that
# the pdnsd user is determined from pdnsd.conf
# I changed this a little (to support whitespaces before
# and after the '=' sign, and to ignore entries that are 
# commented out), so if this is broken, blame me ;-)
#

PATH=/sbin:/bin:/usr/sbin:/usr/bin

test -x @prefix@/sbin/pdnsd || exit 0

case "$1" in
    start)
    	# Check if cache dir exists and recreate if neccessary
	test -d @cachedir@ || mkdir @cachedir@
	#FIXME: Was ist mit /* Kommentaren */ ????
	RUNAS=`grep '^[^#/]run_as /etc/pdnsd.conf | sed 's/.*run_as\W*=\W*"\(.*\)";.*/\1/'`
	[ -z "$RUNAS" ] && RUNAS=nobody
	chown $RUNAS @cachedir@
	echo -n "Starting domain name service: pdnsd"
	start-stop-daemon --start --quiet --pidfile /var/run/pdnsd.pid --name pdnsd \
	--exec @prefix@/sbin/pdnsd -- --daemon -p /var/run/pdnsd.pid \
	|| echo -n " failed"
	echo "."
    ;;

    stop)
	echo -n "Stopping domain name service: pdnsd"
	start-stop-daemon --stop --quiet  --pidfile /var/run/pdnsd.pid --name pdnsd --exec @prefix@/sbin/pdnsd \
	|| echo -n " failed"
	echo "."
    ;;

    restart)
        $0 stop
	$0 start
    ;;
    
    *)
	echo "Usage: /etc/init.d/pdnsd {start|stop|restart}" >&2
	exit 1
    ;;
esac

exit 0
